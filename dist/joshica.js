(()=>{"use strict";class e{constructor(e){this.value="",this.list=[],this.element=e,this.value=this.element.getAttribute("ux")||"",this.list=this.value.split(" ").filter(e=>""!==e.trim())}add(e){this.contains(e)||(this.list.push(e),this.value=this.list.join(" "),this.element.setAttribute("ux",this.value),this.element.ux.refresh())}remove(e){var t;this.contains(e)&&(this.list=this.list.filter(t=>t!==e),this.value=this.list.join(" "),this.element.setAttribute("ux",this.value),(null===(t=this.element.ux)||void 0===t?void 0:t.experiences[e])&&delete this.element.ux.experiences[e],this.element.ux.refresh())}contains(e){return this.list.includes(e)}}function t(e,t){var i;if(!(null===(i=e.ux)||void 0===i?void 0:i.experiences[t])&&r.get().experienceFactories[t]){const i=(0,r.get().experienceFactories[t])(e);return(null==i?void 0:i.onInit)&&i.onInit(),e.ux.experiences[t]=i,i}}class i{constructor(t){this.element=t,this.isRefreshInProgress=!1,this.experiences={},this.element.uxid||(this.element.uxid="_ux_"+Math.random().toString(36).slice(2,7),this.element.setAttribute(this.element.uxid,"")),this.element.uxList||(this.element.uxList=new e(this.element))}refresh(){if(this.isRefreshInProgress)return;this.isRefreshInProgress=!0;const e=this.element.uxList.value;this.element.uxList.list.forEach(e=>{let i=this.experiences[e];i||(i=t(this.element,e)),(null==i?void 0:i.onRefresh)&&i.onRefresh()}),this.isRefreshInProgress=!1,this.children().forEach(e=>{e.ux.refresh()}),e!==this.element.uxList.value&&this.refresh()}parent(){return r.get().getHtmlExperienceElementParent(this.element)}children(){return r.get().getHtmlExperienceElementChildren(this.element)}}class r{constructor(){this.experienceFactories={}}static get(){return r.instance||(r.instance=new r),r.instance}registerExperience(e,t){this.experienceFactories[e]=t}getHtmlExperienceElement(e){return e.ux||(e.ux=new i(e)),e}refresh(){document.querySelectorAll("[ux]").forEach(e=>{const t=this.getHtmlExperienceElement(e);t.ux.parent()||t.ux.refresh()})}getHtmlExperienceElementParent(e){var t=e.parentElement;if(t)return t&&t.getAttribute("ux")?this.getHtmlExperienceElement(t):this.getHtmlExperienceElementParent(t)}getHtmlExperienceElementChildren(e){const t=e.querySelectorAll("[ux]"),i=[];return t.forEach(t=>{this.getHtmlExperienceElementParent(t)===e&&i.push(this.getHtmlExperienceElement(t))}),i}}const n={registerExperience:function(e,t){r.get().registerExperience(e,t)},refresh:function(){r.get().refresh()},querySelector:function(e){const t=document.querySelector(e+"[ux]");if(t){if(t.ux)return t;{const e=r.get().getHtmlExperienceElement(t);return e.ux.refresh(),e}}},querySelectorAll:function(e){return Array.from(document.querySelectorAll(e)).filter(e=>void 0!==e.ux)},getUxExperience:function(e,i){if(null==e?void 0:e.ux)return e.ux.experiences[i]?e.ux.experiences[i]:t(e,i)}};window.ux=n})();